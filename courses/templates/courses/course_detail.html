{% extends 'courses/base.html' %}
{% load static %}

{% block content %}

<style>
.course-container {
    max-width: 1100px;
    margin: auto;
}

/* Course Header */
.course-header {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.15);
    margin-bottom: 30px;
}

.course-header h2 {
    color: #ff6600;
    margin-bottom: 10px;
}

.course-header p {
    line-height: 1.6;
}

.price {
    font-size: 1.1rem;
    font-weight: bold;
    margin-top: 10px;
}

/* Buttons */
.btn {
    display: inline-block;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: bold;
    text-decoration: none;
    margin: 10px 10px 10px 0;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: 0.3s;
}

.btn-primary {
    background-color: #ff6600;
    color: white;
}

.btn-success {
    background-color: #0099ff;
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    opacity: 0.95;
}

/* Modules */
.module {
    margin-bottom: 25px;
}

.module h3 {
    color: #0099ff;
    margin-bottom: 15px;
}

/* Lesson Card */
.lesson-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    margin-bottom: 20px;
}

.lesson-card h4 {
    margin-bottom: 10px;
    color: #333;
}

.lesson-card video {
    width: 100%;
    max-height: 400px;
    border-radius: 8px;
    margin-top: 10px;
}

/* Feedback */
.feedback-section {
    margin-top: 40px;
}

.feedback-section h3 {
    color: #ff6600;
    margin-bottom: 20px;
}

.feedback-card {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    margin-bottom: 15px;
}

.feedback-card strong {
    color: #0099ff;
}

/* Responsive */
@media (max-width: 768px) {
    .course-header {
        padding: 20px;
    }

    .btn {
        width: 100%;
        text-align: center;
    }
}
</style>

<div class="course-container">

    <!-- Course Info -->
    <div class="course-header">
        <h2>{{ course.title }}</h2>
        <p>{{ course.description }}</p>

        <p class="price">
            Price:
            {% if course.price and course.price > 0 %}
                ₹{{ course.price }}
            {% else %}
                Free
            {% endif %}
        </p>

        <!-- ACTION BUTTONS -->
        {% if enrolled %}
            <a href="{% url 'add_feedback' course.id %}" class="btn btn-primary">
                Add Feedback
            </a>
        {% else %}
            {% if course.price and course.price > 0 %}
                <a href="{% url 'buy_course' course.id %}" class="btn btn-success">
                    Buy Course
                </a>
            {% else %}
                <a href="{% url 'enroll_course' course.id %}" class="btn btn-primary">
                    Enroll Now
                </a>
            {% endif %}
        {% endif %}
    </div>
</div>
    <!-- Modules & Lessons -->
    {% if enrolled %}
        {% for module in course.modules.all %}
            <div class="module">
                <h3>{{ module.title }}</h3>

                {% for lesson in module.lessons.all %}
                    <div class="lesson-card">
                        <h4>{{ lesson.title }}</h4>

                        {% if lesson.description %}
                            <p>{{ lesson.description }}</p>
                        {% endif %}

                        {% if lesson.video %}
                            <video controls>
                                <source src="{{ lesson.video.url }}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {% else %}
                            <p>No video available for this lesson.</p>
                        {% endif %}
                    </div>
                {% empty %}
                    <p>No lessons available.</p>
                {% endfor %}
            </div>
        {% empty %}
            <p>No modules available.</p>
        {% endfor %}
    {% else %}
        <p><strong>Please enroll or purchase this course to access lessons.</strong></p>
    {% endif %}

    <!-- Feedback Section -->
    <div class="feedback-section">
        <h3>Student Feedback</h3>

        {% for feedback in course.feedback_set.all %}
            <div class="feedback-card">
                <strong>{{ feedback.user.username }}</strong><br>
                ⭐ {{ feedback.rating }}/5
                <p>{{ feedback.comment }}</p>
            </div>
        {% empty %}
            <p>No feedback yet.</p>
        {% endfor %}
    </div>



{% endblock %}
